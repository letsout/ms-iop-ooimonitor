<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.asiainfo.msooimonitor.mapper.mysql.DownloadFileMapper" >

    <select id="listDownloadFileInterface" resultType="com.asiainfo.msooimonitor.model.ooimodel.InterfaceInfo">
        select a.* from
        ooi_interface_info a
        left join ooi_interfacae_run_record_dtl b on a.interface_id = b.interface_id
        where a.interface_id not in (select distinct interface_id from  ooi_interfacae_run_record_dtl where date_format(b.update_time,'%Y-%m-%d') = date_format(now(),'%Y-%m-%d') )
        and a.interface_deal_type = '2'
        and a.interface_type = '2'
    </select>

    <insert id="insertRecord" parameterType="com.asiainfo.msooimonitor.model.ooimodel.InterfaceRecord">
        insert into ooi_interfacae_run_record_dtl (
        interface_id,
        type_desc,
        run_step,
        file_name,
        file_num,
        file_success_num,
        error_desc,
        update_time
        ) values (
        #{interfaceId},
        #{typeDesc},
        #{runStep},
        #{fileName},
        #{fileNum},
        #{fileSuccessNum},
        #{errorDesc},
        now()
        );
    </insert>
</mapper>